@model IEnumerable<mis4200team2.Models.Employee>
@using mis4200team2.Data;

@{
  ViewBag.Title = "Leaderboard";
  Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid">
  <h2>Leaderboard</h2>

  @using (Html.BeginForm("Leaderboard", "Kudos", null, FormMethod.Post, new { @class = "form-horizontal" }))
  {
    <div class="form-group">
      <label class="sr-only" for="search">Search by name:</label>
      <div class="input-group">
        <input class="form-control" id="search" placeholder="Search for..." type="text" name="Search" value="@ViewData["CurrentFilter"]">
        <span class="input-group-btn">
          <button class="btn btn-outline-primary" type="submit"><span class="glyphicon glyphicon-search"></span>Search</button>
        </span>
      </div>
    </div>

    @Html.ActionLink("Back to List", "Leaderboard")
  }
</div>

<table class="table table-striped table-bordered">
  <tr>
    <th>
      @Html.ActionLink("Last Name", "Leaderboard", new { sort = ViewData["LastNameSort"] })
    </th>
    <th>
      @Html.ActionLink("First Name", "Leaderboard", new { sort = ViewData["FirstNameSort"] })
    </th>
    <th class="text-center">
      @Html.ActionLink("# of Kudos Received", "Leaderboard", new { sort = ViewData["ReceiveSort"] })
    </th>
    <th class="text-center"><strong># of Kudos Sent</strong></th>
    <th></th>
  </tr>

  @foreach (var item in Model)
  {
    <tr>
      <td>
        @Html.DisplayFor(modelItem => item.LastName)
      </td>
      <td>
        @Html.DisplayFor(modelItem => item.FirstName)
      </td>
      <td class="text-center">
        @{
          DataContext db = new DataContext();
          int nReceived = db.KudosDB.Where(k => k.ReceiverID == item.EmployeeID).Count();
          @nReceived
        }
      </td>
      <td class="text-center">
        @{
          int nSent = db.KudosDB.Where(k => k.SenderID == item.EmployeeID).Count();
          @nSent
        }
      </td>
    </tr>
  }

</table>
